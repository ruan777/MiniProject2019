## 思路 根据diff
```c
diff --git a/ssl/d1_both.c b/ssl/d1_both.c
index c5beea8..4d8d2d1 100644 (file)
--- a/ssl/d1_both.c
+++ b/ssl/d1_both.c
@@ -616,6 +616,9 @@ dtls1_reassemble_fragment(SSL *s, struct hm_header_st* msg_hdr, int *ok)
            msg_hdr->msg_len > dtls1_max_handshake_message_len(s))
                goto err;
 
+       if (frag_len == 0)
+               return DTLS1_HM_FRAGMENT_RETRY;
+
        /* Try to find item in queue */
        memset(seq64be,0,sizeof(seq64be));
        seq64be[6] = (unsigned char) (msg_hdr->seq>>8);
@@ -693,7 +696,12 @@ dtls1_reassemble_fragment(SSL *s, struct hm_header_st* msg_hdr, int *ok)
                        goto err;
                        }
 
-               pqueue_insert(s->d1->buffered_messages, item);
+               item = pqueue_insert(s->d1->buffered_messages, item);            
+               OPENSSL_assert(item != NULL);
                }
 
        return DTLS1_HM_FRAGMENT_RETRY;
@@ -751,7 +759,7 @@ dtls1_process_out_of_seq_message(SSL *s, struct hm_header_st* msg_hdr, int *ok)
                }
        else
                {
-               if (frag_len && frag_len < msg_hdr->msg_len)
+               if (frag_len < msg_hdr->msg_len)
                        return dtls1_reassemble_fragment(s, msg_hdr, ok);
 
                if (frag_len > dtls1_max_handshake_message_len(s))
@@ -780,7 +788,15 @@ dtls1_process_out_of_seq_message(SSL *s, struct hm_header_st* msg_hdr, int *ok)
                if ( item == NULL)
                        goto err;
 
-               pqueue_insert(s->d1->buffered_messages, item);
+               item = pqueue_insert(s->d1->buffered_messages, item);     
+               OPENSSL_assert(item != NULL);
                }
 
        return DTLS1_HM_FRAGMENT_RETRY;
```
可知改动在 **dtls1_reassemble_fragment** 和 **dtls1_process_out_of_seq_message** 函数中，所以还是先定位到两个函数的地址
查看这两个函数的源码，发现他们都调用了 **pqueue_find** 和 **pqueue_insert**，于是先找到**pqueue_find** 和 **pqueue_insert**这两个函数，在通过他们的代码引用来定位**dtls1_reassemble_fragment** 和 **dtls1_process_out_of_seq_message** 函数
在找到**dtls1_reassemble_fragment** 和 **dtls1_process_out_of_seq_message** 函数后，从diff中看到他们新加了一句**OPENSSL_assert(item != NULL)**
于是想到通过寻找 **"item != NULL"** 字符串，在查看该字符串的dref中有没有**dtls1_reassemble_fragment** 和 **dtls1_process_out_of_seq_message** 这两个函数来判断cve-2014-3507是否被修复
